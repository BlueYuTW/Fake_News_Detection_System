!pragma charset UTF-8

@startuml SequenceDiagram_LINE_Video_Check
!theme spacelab

' --- 解決字體缺失問題的關鍵指令 ---
skinparam defaultFontName "Microsoft JhengHei"

title 事實查核系統 - LINE 影片查核時序圖

actor "LINE 使用者" as user
participant "LINE 平台" as line_platform
participant "bot.php\n(Webhook)" as webhook
participant "api.php\n(核心 API)" as api
participant "檔案系統" as fs
participant "ffmpeg" as ffmpeg
participant "Sightengine API" as sightengine_api

activate user
user -> line_platform: 1. 傳送影片
activate line_platform

line_platform -> webhook: 2. Webhook 事件 (POST Request)
activate webhook
webhook -> fs: 3. 下載並暫存影片
webhook -> api: 4. 轉發查核請求 (cURL)
activate api

api -> fs: 5. 讀取影片檔案
api -> ffmpeg: 6. 執行命令 (截取影片畫格)
activate ffmpeg
ffmpeg --> api: 7. 回傳畫格路徑
deactivate ffmpeg

api -> sightengine_api: 8. 上傳影片/畫格進行分析 (API Call)
activate sightengine_api
sightengine_api --> api: 9. 回傳分析結果 (JSON)
deactivate sightengine_api

api --> webhook: 10. 回傳最終查核報告
deactivate api

webhook -> line_platform: 11. 回覆訊息 (Reply Message)
deactivate webhook

line_platform --> user: 12. 顯示查核結果
deactivate line_platform
deactivate user

@enduml